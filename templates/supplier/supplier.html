<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supplier Dashboard - Inventra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://upload-widget.cloudinary.com/global/all.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .nav-item:hover {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
        }
        .nav-item.active {
            background: rgba(245, 158, 11, 0.15);
            border-left: 4px solid #f59e0b;
            font-weight: 600;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-approved { background-color: #dbeafe; color: #1e40af; }
        .status-ordered { background-color: #e9d5ff; color: #7e22ce; }
        .status-delivered { background-color: #d1fae5; color: #065f46; }
        .status-cancelled { background-color: #fee2e2; color: #991b1b; }
    </style>
</head>
<body class="bg-gray-100">
    
    <!-- SIDEBAR -->
    <aside class="fixed top-0 left-0 z-40 w-64 h-screen bg-white shadow-lg">
        <div class="h-full px-3 py-4 overflow-y-auto">
            <div class="flex items-center mb-5 px-3">
                <div class="w-10 h-10 bg-gradient-to-br from-orange-400 to-orange-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-truck text-white text-xl"></i>
                </div>
                <div class="ml-3">
                    <h2 class="text-xl font-bold text-gray-800">Supplier Panel</h2>
                    <p class="text-xs text-gray-500">Vendor Portal</p>
                </div>
            </div>

            <div class="mb-5 p-3 bg-orange-50 rounded-lg border border-orange-100">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold">
                        {{ current_user.username[0].upper() }}
                    </div>
                    <div>
                        <p class="text-sm font-semibold text-gray-800">{{ current_user.username }}</p>
                        <p class="text-xs text-orange-600">Supplier</p>
                    </div>
                </div>
            </div>

            <nav class="space-y-2">
                <p class="px-3 text-xs font-semibold text-gray-500 uppercase mb-2">Supplier Menu</p>
                
                <a href="#" onclick="showSection('dashboard')" class="nav-item active flex items-center px-3 py-2.5 text-gray-700 rounded-lg">
                    <i class="fas fa-chart-line w-5"></i>
                    <span class="ml-3">Dashboard</span>
                </a>
                
                <a href="#" onclick="showSection('orders')" class="nav-item flex items-center px-3 py-2.5 text-gray-700 rounded-lg">
                    <i class="fas fa-shopping-cart w-5"></i>
                    <span class="ml-3">Purchase Orders</span>
                    {% set pending_count = purchase_orders|selectattr('status', 'equalto', 'pending')|list|length %}
                    {% if pending_count > 0 %}
                    <span class="ml-auto bg-orange-500 text-white text-xs w-6 h-6 rounded-full flex items-center justify-center">{{ pending_count }}</span>
                    {% endif %}
                </a>
                
                <a href="#" onclick="showSection('products')" class="nav-item flex items-center px-3 py-2.5 text-gray-700 rounded-lg">
                    <i class="fas fa-box w-5"></i>
                    <span class="ml-3">My Products</span>
                </a>
                
                <a href="#" onclick="showSection('performance')" class="nav-item flex items-center px-3 py-2.5 text-gray-700 rounded-lg">
                    <i class="fas fa-chart-bar w-5"></i>
                    <span class="ml-3">Performance</span>
                </a>
                
                <hr class="my-3 border-gray-200">
                
                <a href="{{ url_for('logout') }}" class="nav-item flex items-center px-3 py-2.5 text-red-600 rounded-lg hover:bg-red-50">
                    <i class="fas fa-sign-out-alt w-5"></i>
                    <span class="ml-3">Logout</span>
                </a>
            </nav>
        </div>
    </aside>

    <!-- MAIN -->
    <div class="ml-64">
        <header class="bg-white shadow-sm sticky top-0 z-30">
            <div class="flex items-center justify-between px-6 py-4">
                <h1 id="pageTitle" class="text-xl font-semibold text-gray-800">Dashboard</h1>
                
                <div class="flex items-center space-x-4">
    <!-- Notification Bell -->
    <div class="relative">
        <button onclick="toggleNotifications()" class="relative text-gray-600 hover:text-gray-800">
            <i class="fas fa-bell text-xl"></i>
            {% set unread_notifications = notifications|selectattr('is_read', 'equalto', false)|list %}
            {% if unread_notifications|length > 0 %}
            <span class="absolute -top-1 -right-1 bg-orange-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">
                {{ unread_notifications|length }}
            </span>
            {% endif %}
        </button>
        
        <!-- Notifications Dropdown -->
        <div id="notificationsDropdown" class="hidden absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl z-50 border">
            <div class="p-4 border-b flex justify-between items-center">
                <h3 class="font-semibold text-gray-800">Notifications</h3>
                {% if notifications|selectattr('is_read', 'equalto', false)|list|length > 0 %}
                <button onclick="markAllNotificationsRead()" class="text-xs text-blue-600 hover:text-blue-800 font-medium">
                    Mark all as read
                </button>
                {% endif %}
            </div>
            <div class="max-h-96 overflow-y-auto">
                {% if notifications %}
                {% for notification in notifications %}
                <div class="p-4 border-b {% if not notification.is_read %}bg-blue-50 border-l-4 border-l-blue-500{% endif %} hover:bg-gray-50 transition-colors">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-1">
                                {% if notification.type == 'success' %}
                                <i class="fas fa-check-circle text-green-500"></i>
                                {% elif notification.type == 'error' %}
                                <i class="fas fa-times-circle text-red-500"></i>
                                {% elif notification.type == 'warning' %}
                                <i class="fas fa-exclamation-triangle text-yellow-500"></i>
                                {% else %}
                                <i class="fas fa-info-circle text-blue-500"></i>
                                {% endif %}
                                <p class="font-medium text-gray-900 text-sm">{{ notification.title }}</p>
                            </div>
                            <p class="text-sm text-gray-600 mt-1">{{ notification.message }}</p>
                            <p class="text-xs text-gray-400 mt-2">{{ notification.created_at.strftime('%b %d, %H:%M') }}</p>
                        </div>
                        {% if not notification.is_read %}
                        <button onclick="markNotificationRead('{{ notification.id }}')" 
                                class="ml-2 text-blue-600 hover:text-blue-800 p-1 rounded-full hover:bg-blue-50">
                            <i class="fas fa-check text-xs"></i>
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="p-8 text-center text-gray-500">
                    <i class="fas fa-bell-slash text-2xl mb-2"></i>
                    <p>No notifications</p>
                    <p class="text-sm mt-1">You're all caught up!</p>
                </div>
                {% endif %}
            </div>
            <div class="p-3 border-t bg-gray-50 text-center">
                <a href="#" onclick="showAllNotifications()" class="text-sm text-blue-600 hover:text-blue-800 font-medium">
                    View all notifications
                </a>
            </div>
        </div>
    </div>

    
    <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
        {{ current_user.username[0].upper() }}
    </div>
</div>
            </div>
        </header>

        <main class="p-6">
            {% if not supplier %}
            <div class="bg-white rounded-xl shadow-sm p-8 text-center">
                <i class="fas fa-exclamation-triangle text-4xl text-orange-500 mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Supplier Profile Not Found</h2>
                <p class="text-gray-600 mb-4">Your user account is not linked to a supplier profile.</p>
                <p class="text-sm text-gray-500">Please contact the system administrator to set up your supplier profile.</p>
            </div>
            {% else %}
            
            <!-- DASHBOARD -->
            <div id="dashboard-section" class="content-section active">
                <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl shadow-lg p-6 text-white mb-6">
                    <h2 class="text-2xl font-bold mb-2">Welcome, {{ supplier.name }}! </h2>
                    <p class="text-orange-100">Supplier Dashboard - Track your orders and performance</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md transition">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-shopping-cart text-blue-600 text-xl"></i>
                        </div>
                        <h3 class="text-gray-500 text-sm mb-1">Total Orders</h3>
                        <p class="text-3xl font-bold text-gray-900">{{ total_orders }}</p>
                        <p class="text-xs text-gray-500 mt-1">All purchase orders</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md transition">
                        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-clock text-orange-600 text-xl"></i>
                        </div>
                        <h3 class="text-gray-500 text-sm mb-1">Pending Orders</h3>
                        <p class="text-3xl font-bold text-gray-900">{{ pending_orders }}</p>
                        <p class="text-xs text-gray-500 mt-1">Awaiting action</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md transition">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-check-circle text-green-600 text-xl"></i>
                        </div>
                        <h3 class="text-gray-500 text-sm mb-1">Delivered</h3>
                        <p class="text-3xl font-bold text-gray-900">{{ delivered_orders }}</p>
                        <p class="text-xs text-gray-500 mt-1">Completed orders</p>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md transition">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-box text-purple-600 text-xl"></i>
                        </div>
                        <h3 class="text-gray-500 text-sm mb-1">My Products</h3>
                        <p class="text-3xl font-bold text-gray-900">{{ total_products }}</p>
                        <p class="text-xs text-gray-500 mt-1">Products supplied</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="space-y-8">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Recent Purchase Orders</h3>
                                <a href="#" onclick="showSection('orders')" class="text-sm text-orange-600 hover:text-orange-800">View All</a>
                            </div>
                            
                            <div class="space-y-4">
                                {% for order in purchase_orders %}
                                <div class="order-item bg-gray-50 rounded-lg border p-4" data-status="{{ order.status }}">
                                    <div class="flex items-center justify-between mb-3">
                                        <div>
                                            <h3 class="font-semibold text-gray-900">{{ order.order_number }}</h3>
                                            <p class="text-sm text-gray-500">{{ order.order_date.strftime('%b %d, %Y') }}</p>
                                        </div>
                                        <div class="text-right">
                                            <span class="px-3 py-1 text-sm font-semibold rounded-full status-{{ order.status }}">
                                                {{ order.status|title }}
                                            </span>
                                            <p class="text-lg font-bold text-gray-900 mt-1">KES {{ "%.2f"|format(order.total_amount) }}</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Supplier Actions -->
                                    <div class="flex items-center justify-between">
                                        <p class="text-sm text-gray-600">{{ order.notes or 'No notes' }}</p>
                                        <div class="flex space-x-2">
                                            {% if order.status == 'pending' %}
                                            <button onclick="confirmOrder('{{ order.id }}')" 
                                                    class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                                <i class="fas fa-check mr-1"></i> Confirm Order
                                            </button>
                                            <button onclick="declineOrder('{{ order.id }}')" 
                                                    class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                                <i class="fas fa-times mr-1"></i> Decline
                                            </button>
                                            {% elif order.status == 'approved' %}
                                            <button onclick="markAsOrdered('{{ order.id }}')" 
                                                    class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                                <i class="fas fa-truck mr-1"></i> Mark as Shipped
                                            </button>
                                            {% elif order.status == 'ordered' %}
                                            <button onclick="markAsDelivered('{{ order.id }}')" 
                                                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                                <i class="fas fa-box-open mr-1"></i> Mark as Delivered
                                            </button>
                                            {% endif %}
                                            <button onclick="showOrderDetails('{{ order.id }}')" 
                                                    class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                                <i class="fas fa-eye mr-1"></i> View
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% else %}
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-shopping-cart text-4xl mb-3 text-gray-300"></i>
                                    <p>No purchase orders yet</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">My Products</h3>
                            <div class="space-y-3">
                                {% for product in products[:5] %}
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        {% if product.image_url %}
                                            <img src="{{ product.image_url }}" alt="{{ product.name }}" class="w-10 h-10 rounded-lg object-cover">
                                        {% else %}
                                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                                <i class="fas fa-box text-blue-600"></i>
                                            </div>
                                        {% endif %}
                                        <div>
                                            <p class="font-medium text-gray-900">{{ product.name }}</p>
                                            <p class="text-sm text-gray-500">{{ product.sku }}</p>
                                        </div>
                                    </div>
                                    <span class="text-sm font-medium text-green-600">KES {{ "%.2f"|format(product.price) }}</span>
                                </div>
                                {% else %}
                                <div class="text-center py-8 text-gray-500">
                                    <i class="fas fa-box text-4xl mb-3 text-gray-300"></i>
                                    <p>No products assigned</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="space-y-8">
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Supplier Information</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm text-gray-600">Company Name</span>
                                    <span class="font-medium text-gray-900">{{ supplier.name }}</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm text-gray-600">Contact Person</span>
                                    <span class="font-medium text-gray-900">{{ supplier.contact_person or 'N/A' }}</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm text-gray-600">Email</span>
                                    <span class="font-medium text-gray-900">{{ supplier.email }}</span>
                                </div>
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm text-gray-600">Phone</span>
                                    <span class="font-medium text-gray-900">{{ supplier.phone or 'N/A' }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <a href="#" onclick="showSection('orders')" class="p-4 bg-orange-50 rounded-lg border border-orange-200 hover:bg-orange-100 transition-colors text-center">
                                    <i class="fas fa-file-invoice text-orange-600 text-lg mb-2"></i>
                                    <p class="font-medium text-orange-700 text-sm">View Orders</p>
                                </a>
                                <a href="#" onclick="showSection('products')" class="p-4 bg-blue-50 rounded-lg border border-blue-200 hover:bg-blue-100 transition-colors text-center">
                                    <i class="fas fa-box text-blue-600 text-lg mb-2"></i>
                                    <p class="font-medium text-blue-700 text-sm">My Products</p>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PURCHASE ORDERS -->
            <div id="orders-section" class="content-section">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Purchase Orders</h2>
                        <select id="statusFilter" onchange="filterOrders()" class="border border-gray-300 rounded-lg px-3 py-2">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="ordered">Ordered</option>
                            <option value="delivered">Delivered</option>
                        </select>
                    </div>

                    <div class="space-y-4">
                        {% for order in purchase_orders %}
                        <div class="order-item bg-gray-50 rounded-lg border p-4" data-status="{{ order.status }}">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <h3 class="font-semibold text-gray-900">{{ order.order_number }}</h3>
                                    <p class="text-sm text-gray-500">{{ order.order_date.strftime('%b %d, %Y') }}</p>
                                </div>
                                <div class="text-right">
                                    <span class="px-3 py-1 text-sm font-semibold rounded-full status-{{ order.status }}">
                                        {{ order.status|title }}
                                    </span>
                                    <p class="text-lg font-bold text-gray-900 mt-1">KES {{ "%.2f"|format(order.total_amount) }}</p>
                                </div>
                            </div>
                            
                            <!-- Supplier Actions -->
                            <div class="flex items-center justify-between">
                                <p class="text-sm text-gray-600">{{ order.notes or 'No notes' }}</p>
                                <div class="flex space-x-2">
                                    {% if order.status == 'pending' %}
                                    <button onclick="confirmOrder('{{ order.id }}')" 
                                            class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                        <i class="fas fa-check mr-1"></i> Confirm Order
                                    </button>
                                    <button onclick="declineOrder('{{ order.id }}')" 
                                            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                        <i class="fas fa-times mr-1"></i> Decline
                                    </button>
                                    {% elif order.status == 'approved' %}
                                    <button onclick="markAsOrdered('{{ order.id }}')" 
                                            class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                        <i class="fas fa-truck mr-1"></i> Mark as Shipped
                                    </button>
                                    {% elif order.status == 'ordered' %}
                                    <button onclick="markAsDelivered('{{ order.id }}')" 
                                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                        <i class="fas fa-box-open mr-1"></i> Mark as Delivered
                                    </button>
                                    {% endif %}
                                    <button onclick="showOrderDetails('{{ order.id }}')" 
                                            class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                        <i class="fas fa-eye mr-1"></i> View
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% else %}
                        <div class="text-center py-12">
                            <i class="fas fa-shopping-cart text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">No Purchase Orders</h3>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- MY PRODUCTS -->
            <div id="products-section" class="content-section">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">My Products</h2>
                        <button onclick="openAddProductModal()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium">
                            <i class="fas fa-plus mr-2"></i>Add Product
                        </button>
                    </div>

                    <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        {% for product in products %}
                        <div class="bg-gray-50 rounded-lg border p-4 hover:shadow-md transition-shadow" data-product-id="{{ product.id }}">
                            <!-- Product Image -->
                            <div class="mb-3">
                                {% if product.image_url %}
                                    <img src="{{ product.image_url }}" alt="{{ product.name }}" class="w-full h-40 object-cover rounded-lg">
                                {% else %}
                                    <div class="w-full h-40 bg-blue-100 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-box text-blue-600 text-4xl"></i>
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <h3 class="font-semibold text-gray-900 text-lg">{{ product.name }}</h3>
                                <p class="text-sm text-gray-500">{{ product.sku }}</p>
                                {% if product.description %}
                                <p class="text-sm text-gray-600 mt-2">{{ product.description[:80] }}{% if product.description|length > 80 %}...{% endif %}</p>
                                {% endif %}
                            </div>
                            
                            <div class="space-y-2 mb-4">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Price</span>
                                    <span class="font-bold text-green-600">KES {{ "%.2f"|format(product.price) }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Unit</span>
                                    <span class="font-medium text-gray-900">{{ product.unit or 'Piece' }}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Category</span>
                                    <span class="font-medium text-blue-600">{{ product.category.name if product.category else 'General' }}</span>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex space-x-2">
                                <button onclick="openEditProductModal('{{ product.id }}')" 
                                        class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-3 rounded-lg text-sm font-medium transition-colors">
                                    <i class="fas fa-edit mr-1"></i> Edit
                                </button>
                                <button onclick="deleteProduct('{{ product.id }}')" 
                                        class="flex-1 bg-red-500 hover:bg-red-600 text-white py-2 px-3 rounded-lg text-sm font-medium transition-colors">
                                    <i class="fas fa-trash mr-1"></i> Delete
                                </button>
                            </div>
                        </div>
                        {% else %}
                        <div class="col-span-3 text-center py-12">
                            <i class="fas fa-box text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">No Products Yet</h3>
                            <p class="text-gray-500 mb-4">Start by adding your first product</p>
                            <button onclick="openAddProductModal()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg">
                                <i class="fas fa-plus mr-2"></i>Add Your First Product
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- PERFORMANCE -->
            <div id="performance-section" class="content-section">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Supplier Performance</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-6">
                            <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg p-6 text-white">
                                <h3 class="text-lg font-semibold mb-2">Order Fulfillment Rate</h3>
                                <p class="text-3xl font-bold">{{ ((delivered_orders / total_orders) * 100)|round(1) if total_orders > 0 else 0 }}%</p>
                                <p class="text-orange-100 text-sm">Successful deliveries</p>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">Monthly Summary</h3>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Total Orders</span>
                                        <span class="font-semibold">{{ total_orders }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Pending</span>
                                        <span class="font-semibold text-yellow-600">{{ pending_orders }}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Delivered</span>
                                        <span class="font-semibold text-green-600">{{ delivered_orders }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-6">
                            <div class="bg-gray-50 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Activity</h3>
                                <div class="space-y-3">
                                    {% for order in purchase_orders[:3] %}
                                    <div class="flex items-center justify-between p-3 bg-white rounded border">
                                        <div>
                                            <p class="font-medium text-sm">{{ order.order_number }}</p>
                                            <p class="text-xs text-gray-500">{{ order.order_date.strftime('%b %d') }}</p>
                                        </div>
                                        <span class="px-2 py-1 text-xs rounded-full status-{{ order.status }}">
                                            {{ order.status|title }}
                                        </span>
                                    </div>
                                    {% else %}
                                    <p class="text-gray-500 text-center py-4">No recent activity</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {% endif %}
        </main>
    </div>

    <!-- ORDER DETAILS MODAL -->
    <div id="orderDetailsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium">Order Details</h3>
                <button onclick="closeOrderDetails()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="orderDetailsContent">Loading...</div>
        </div>
    </div>

    <!-- ADD PRODUCT MODAL -->
    <div id="addProductModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Add New Product</h3>
                <button onclick="closeAddProductModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="addProductForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Product Name *</label>
                    <input type="text" name="name" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">SKU *</label>
                    <input type="text" name="sku" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea name="description" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Price (KES) *</label>
                        <input type="number" name="price" step="0.01" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Unit</label>
                        <select name="unit" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <option value="piece">Piece</option>
                            <option value="bale">Bale</option>
                            <option value="kg">Kilogram</option>
                            <option value="liter">Liter</option>
                            <option value="box">Box</option>
                            <option value="pack">Pack</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                    <select name="category_id" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <option value="">Select Category</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Product Image</label>
                    <input type="hidden" name="image_url" id="productImageUrl">
                    
                    <div id="uploadButton" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-orange-500 transition-colors cursor-pointer">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                        <p class="text-sm text-gray-600 font-medium">Click to upload product image</p>
                        <p class="text-xs text-gray-400 mt-1">JPG, PNG or WEBP (Max 5MB)</p>
                    </div>
                    
                    <div id="imagePreview" class="mt-4 hidden">
                        <div class="relative">
                            <img id="previewImg" src="" class="w-full h-64 object-cover rounded-lg border-2 border-green-500">
                            <button type="button" onclick="removeImage()" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-600">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="mt-2 text-center">
                                <p class="text-sm text-green-600 font-medium">✓ Image uploaded successfully</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4 border-t">
                    <button type="button" onclick="closeAddProductModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600">
                        <i class="fas fa-plus mr-2"></i>Add Product
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- EDIT PRODUCT MODAL -->
    <div id="editProductModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
        <div class="relative top-10 mx-auto p-5 border w-11/12 md:w-1/2 shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Edit Product</h3>
                <button onclick="closeEditProductModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="editProductForm" class="space-y-4">
                <input type="hidden" name="product_id" id="editProductId">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Product Name *</label>
                    <input type="text" name="name" id="editProductName" required 
                           class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">SKU *</label>
                    <input type="text" name="sku" id="editProductSku" required 
                           class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea name="description" id="editProductDescription" rows="3"
                              class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500"></textarea>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Price (KES) *</label>
                        <input type="number" name="price" id="editProductPrice" step="0.01" required 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Unit</label>
                        <select name="unit" id="editProductUnit" 
                                class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <option value="piece">Piece</option>
                            <option value="bale">Bale</option>
                            <option value="kg">Kilogram</option>
                            <option value="liter">Liter</option>
                            <option value="box">Box</option>
                            <option value="pack">Pack</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Category *</label>
                    <select name="category_id" id="editProductCategory" required 
                            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-orange-500">
                        <option value="">Select Category</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Product Image</label>
                    <input type="hidden" name="image_url" id="editProductImageUrl">
                    
                    <div id="editUploadButton" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-orange-500 transition-colors cursor-pointer">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3"></i>
                        <p class="text-sm text-gray-600 font-medium">Click to upload product image</p>
                        <p class="text-xs text-gray-400 mt-1">JPG, PNG or WEBP (Max 5MB)</p>
                    </div>
                    
                    <div id="editImagePreview" class="mt-4 hidden">
                        <div class="relative">
                            <img id="editPreviewImg" src="" class="w-full h-64 object-cover rounded-lg border-2 border-green-500">
                            <button type="button" onclick="removeEditImage()" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-600">
                                <i class="fas fa-times"></i>
                            </button>
                            <div class="mt-2 text-center">
                                <p class="text-sm text-green-600 font-medium">✓ Image uploaded successfully</p>
                            </div>
                        </div>
                    </div>

                    <!-- Current Image Display -->
                    <div id="currentImageDisplay" class="mt-4 hidden">
                        <p class="text-sm text-gray-600 mb-2">Current Image:</p>
                        <img id="currentProductImage" src="" class="w-full h-64 object-cover rounded-lg border-2 border-blue-500">
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 pt-4 border-t">
                    <button type="button" onclick="closeEditProductModal()" 
                            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit" 
                            class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600">
                        <i class="fas fa-save mr-2"></i>Update Product
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Cloudinary Configuration
        const CLOUDINARY_CONFIG = {
            cloudName: 'dh3nh9mck',
            uploadPreset: 'Inventra'
        };

        // Section Switching
        function showSection(sectionName) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById(sectionName + '-section').classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            const titles = {
                'dashboard': 'Dashboard',
                'orders': 'Purchase Orders',
                'products': 'My Products',
                'performance': 'Performance'
            };
            document.getElementById('pageTitle').textContent = titles[sectionName];
        }

        // Filter orders by status
        function filterOrders() {
            const status = document.getElementById('statusFilter').value;
            const orderItems = document.querySelectorAll('.order-item');
            
            orderItems.forEach(item => {
                if (status === 'all' || item.dataset.status === status) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Show order details
        function showOrderDetails(orderId) {
            document.getElementById('orderDetailsModal').classList.remove('hidden');
            document.getElementById('orderDetailsContent').innerHTML = '<p>Loading order details...</p>';
            
            fetch('/supplier/orders/' + orderId + '/details')
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('orderDetailsContent').innerHTML = data.html;
                    } else {
                        document.getElementById('orderDetailsContent').innerHTML = '<p class="text-red-600">Error loading order details</p>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('orderDetailsContent').innerHTML = '<p class="text-red-600">Error loading order details</p>';
                });
        }

        function closeOrderDetails() {
            document.getElementById('orderDetailsModal').classList.add('hidden');
        }

        // Open Add Product Modal
        function openAddProductModal() {
            document.getElementById('addProductModal').classList.remove('hidden');
        }

        // Close Add Product Modal
        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.add('hidden');
            document.getElementById('addProductForm').reset();
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('uploadButton').classList.remove('hidden');
            document.getElementById('productImageUrl').value = '';
        }

        // Remove uploaded image
        function removeImage() {
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('uploadButton').classList.remove('hidden');
            document.getElementById('productImageUrl').value = '';
        }

        // Upload Product Image to Cloudinary
        function uploadProductImage() {
            // Check if Cloudinary is loaded
            if (typeof cloudinary === 'undefined') {
                alert('Cloudinary widget not loaded. Please refresh the page and try again.');
                console.error('Cloudinary widget not loaded');
                return;
            }
            
            const widget = cloudinary.createUploadWidget({
                cloudName: CLOUDINARY_CONFIG.cloudName,
                uploadPreset: CLOUDINARY_CONFIG.uploadPreset,
                sources: ['local', 'camera'],
                multiple: false,
                maxFiles: 1,
                maxFileSize: 5000000, // 5MB
                clientAllowedFormats: ['jpg', 'png', 'jpeg', 'webp'],
                cropping: false,
                folder: 'inventra/products',
                resourceType: 'image'
            }, (error, result) => {
                if (error) {
                    console.error('Upload error:', error);
                    alert('Error uploading image: ' + error.message);
                    return;
                }
                
                if (result && result.event === "success") {
                    console.log('Upload successful:', result.info);
                    const imageUrl = result.info.secure_url;
                    
                    // Update form
                    document.getElementById('productImageUrl').value = imageUrl;
                    document.getElementById('previewImg').src = imageUrl;
                    document.getElementById('imagePreview').classList.remove('hidden');
                    document.getElementById('uploadButton').classList.add('hidden');
                    
                    console.log('Image URL saved:', imageUrl);
                }
            });
            
            widget.open();
        }

        // Initialize upload button click handler
        document.addEventListener('DOMContentLoaded', function() {
            // Make upload area clickable
            const uploadButton = document.getElementById('uploadButton');
            if (uploadButton) {
                uploadButton.addEventListener('click', uploadProductImage);
            }

            // Submit Add Product Form
            document.getElementById('addProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const productData = {};
                
                formData.forEach((value, key) => {
                    productData[key] = value;
                });
                
                // Validate category is selected
                if (!productData.category_id) {
                    alert('Please select a category');
                    return;
                }
                
                // Validate required fields
                if (!productData.name || !productData.sku || !productData.price) {
                    alert('Please fill in all required fields (Name, SKU, Price)');
                    return;
                }
                
                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Adding Product...';
                submitBtn.disabled = true;
                
                console.log('Submitting product data:', productData);
                
                fetch('/supplier/products/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Product added successfully!');
                        closeAddProductModal();
                        // Reload page to show new product
                        window.location.reload();
                    } else {
                        alert('Error: ' + data.message);
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                })
                .catch(error => {
                    alert('Error adding product. Please try again.');
                    console.error('Error:', error);
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
            });
        });

        // Edit Product Modal Functions
        function openEditProductModal(productId) {
            // Show loading state
            document.getElementById('editProductModal').classList.remove('hidden');
            document.getElementById('editProductForm').reset();
            
            // Fetch product data
            fetch(`/supplier/products/${productId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const product = data.product;
                        
                        // Populate form fields
                        document.getElementById('editProductId').value = product.id;
                        document.getElementById('editProductName').value = product.name;
                        document.getElementById('editProductSku').value = product.sku;
                        document.getElementById('editProductDescription').value = product.description || '';
                        document.getElementById('editProductPrice').value = product.price;
                        document.getElementById('editProductUnit').value = product.unit || 'piece';
                        document.getElementById('editProductCategory').value = product.category_id;
                        document.getElementById('editProductImageUrl').value = product.image_url || '';
                        
                        // Handle image display
                        if (product.image_url) {
                            document.getElementById('currentProductImage').src = product.image_url;
                            document.getElementById('currentImageDisplay').classList.remove('hidden');
                            document.getElementById('editUploadButton').classList.add('hidden');
                            document.getElementById('editImagePreview').classList.add('hidden');
                        } else {
                            document.getElementById('currentImageDisplay').classList.add('hidden');
                            document.getElementById('editUploadButton').classList.remove('hidden');
                        }
                    } else {
                        alert('Error loading product data');
                        closeEditProductModal();
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error loading product data');
                    closeEditProductModal();
                });
        }

        function closeEditProductModal() {
            document.getElementById('editProductModal').classList.add('hidden');
            document.getElementById('editProductForm').reset();
            document.getElementById('currentImageDisplay').classList.add('hidden');
            document.getElementById('editUploadButton').classList.remove('hidden');
            document.getElementById('editImagePreview').classList.add('hidden');
            document.getElementById('editProductImageUrl').value = '';
        }

        function removeEditImage() {
            document.getElementById('editImagePreview').classList.add('hidden');
            document.getElementById('editUploadButton').classList.remove('hidden');
            document.getElementById('editProductImageUrl').value = '';
        }

        // Edit Product Image Upload
        function uploadEditProductImage() {
            if (typeof cloudinary === 'undefined') {
                alert('Cloudinary widget not loaded. Please refresh the page and try again.');
                return;
            }
            
            const widget = cloudinary.createUploadWidget({
                cloudName: CLOUDINARY_CONFIG.cloudName,
                uploadPreset: CLOUDINARY_CONFIG.uploadPreset,
                sources: ['local', 'camera'],
                multiple: false,
                maxFiles: 1,
                maxFileSize: 5000000,
                clientAllowedFormats: ['jpg', 'png', 'jpeg', 'webp'],
                cropping: false,
                folder: 'inventra/products',
                resourceType: 'image'
            }, (error, result) => {
                if (error) {
                    console.error('Upload error:', error);
                    alert('Error uploading image: ' + error.message);
                    return;
                }
                
                if (result && result.event === "success") {
                    const imageUrl = result.info.secure_url;
                    
                    // Update form
                    document.getElementById('editProductImageUrl').value = imageUrl;
                    document.getElementById('editPreviewImg').src = imageUrl;
                    document.getElementById('editImagePreview').classList.remove('hidden');
                    document.getElementById('editUploadButton').classList.add('hidden');
                    document.getElementById('currentImageDisplay').classList.add('hidden');
                }
            });
            
            widget.open();
        }

        // Delete Product Function
        function deleteProduct(productId) {
            if (!confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
                return;
            }
            
            fetch(`/supplier/products/${productId}/delete`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Product deleted successfully!');
                    // Remove product from DOM
                    const productElement = document.querySelector(`[data-product-id="${productId}"]`);
                    if (productElement) {
                        productElement.remove();
                    }
                    // Reload if no products left
                    if (document.querySelectorAll('[data-product-id]').length === 0) {
                        window.location.reload();
                    }
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting product');
            });
        }

        // Initialize edit form submission
        document.addEventListener('DOMContentLoaded', function() {
            // Edit upload button
            const editUploadButton = document.getElementById('editUploadButton');
            if (editUploadButton) {
                editUploadButton.addEventListener('click', uploadEditProductImage);
            }

            // Edit form submission
            document.getElementById('editProductForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const productData = {};
                formData.forEach((value, key) => {
                    productData[key] = value;
                });
                
                const productId = productData.product_id;
                
                // Validate
                if (!productData.name || !productData.sku || !productData.price || !productData.category_id) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // Show loading state
                const submitBtn = this.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Updating...';
                submitBtn.disabled = true;
                
                fetch(`/supplier/products/${productId}/edit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(productData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Product updated successfully!');
                        closeEditProductModal();
                        window.location.reload(); // Reload to show updated data
                    } else {
                        alert('Error: ' + data.message);
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                })
                .catch(error => {
                    alert('Error updating product. Please try again.');
                    console.error('Error:', error);
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
            });
        });

        // Supplier order management
        async function confirmOrder(orderId) {
            if (confirm('Confirm that you can fulfill this order?')) {
                try {
                    const response = await fetch(`/supplier/orders/${orderId}/confirm`, {
                        method: 'POST'
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('Order confirmed successfully!');
                        location.reload();
                    } else {
                        alert('Error: ' + result.message);
                    }
                } catch (error) {
                    alert('Error confirming order: ' + error);
                }
            }
        }

        async function declineOrder(orderId) {
            const reason = prompt('Please provide a reason for declining this order:');
            if (reason) {
                try {
                    const response = await fetch(`/supplier/orders/${orderId}/decline`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ reason: reason })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        alert('Order declined successfully!');
                        location.reload();
                    } else {
                        alert('Error: ' + result.message);
                    }
                } catch (error) {
                    alert('Error declining order: ' + error);
                }
            }
        }

        async function markAsOrdered(orderId) {
            try {
                const response = await fetch(`/supplier/orders/${orderId}/update-status`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ status: 'ordered' })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Order marked as shipped!');
                    location.reload();
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (error) {
                alert('Error updating order: ' + error);
            }
        }

        async function markAsDelivered(orderId) {
            try {
                const response = await fetch(`/supplier/orders/${orderId}/update-status`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ status: 'delivered' })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Order marked as delivered!');
                    location.reload();
                } else {
                    alert('Error: ' + result.message);
                }
            } catch (error) {
                alert('Error updating order: ' + error);
            }
        }

        // Notification functions for supplier
function toggleNotifications() {
    const dropdown = document.getElementById('notificationsDropdown');
    dropdown.classList.toggle('hidden');
}

async function markNotificationRead(notificationId) {
    try {
        const response = await fetch(`/notifications/${notificationId}/read`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        if (response.ok) {
            // Update UI without full page reload
            const notificationElement = document.querySelector(`[onclick="markNotificationRead('${notificationId}')"]`);
            if (notificationElement) {
                notificationElement.closest('.bg-blue-50').classList.remove('bg-blue-50', 'border-l-4', 'border-l-blue-500');
                notificationElement.remove();
            }
            updateNotificationBadge();
        }
    } catch (error) {
        console.error('Error marking notification read:', error);
        alert('Error marking notification as read');
    }
}

async function markAllNotificationsRead() {
    try {
        const response = await fetch('/notifications/read-all', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        if (response.ok) {
            // Update UI
            document.querySelectorAll('.bg-blue-50').forEach(element => {
                element.classList.remove('bg-blue-50', 'border-l-4', 'border-l-blue-500');
            });
            document.querySelectorAll('[onclick^="markNotificationRead"]').forEach(button => {
                button.remove();
            });
            updateNotificationBadge();
        }
    } catch (error) {
        console.error('Error marking all notifications read:', error);
        alert('Error marking all notifications as read');
    }
}

function updateNotificationBadge() {
    const unreadCount = document.querySelectorAll('.bg-blue-50').length;
    const badge = document.querySelector('.bg-orange-500');
    
    if (unreadCount > 0) {
        if (badge) {
            badge.textContent = unreadCount;
        } else {
            // Create badge if it doesn't exist
            const bell = document.querySelector('button[onclick="toggleNotifications()"]');
            const newBadge = document.createElement('span');
            newBadge.className = 'absolute -top-1 -right-1 bg-orange-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center';
            newBadge.textContent = unreadCount;
            bell.appendChild(newBadge);
        }
    } else {
        // Remove badge if no unread notifications
        if (badge) {
            badge.remove();
        }
    }
}

function showAllNotifications() {
    // You can implement a dedicated notifications page if needed
    alert('Showing all notifications - you can implement a dedicated page here');
}

// Close notifications when clicking outside
document.addEventListener('click', function(event) {
    const notifications = document.getElementById('notificationsDropdown');
    const bell = event.target.closest('button[onclick="toggleNotifications()"]');
    
    if (!bell && notifications && !notifications.contains(event.target)) {
        notifications.classList.add('hidden');
    }
});

// Auto-refresh notifications every 30 seconds
setInterval(() => {
    
    console.log('Checking for new notifications...');
}, 30000);


document.addEventListener('DOMContentLoaded', function() {
    updateNotificationBadge();
});
    </script>
</body>
</html>